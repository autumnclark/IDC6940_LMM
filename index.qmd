---
title: "Gathering insights about COVID19 Worldwide Testing using Linear Mixed Models"
subtitle: "An analysis of linear mixed model algorithms and it's applications"

author: "Autumn Clark and Alex Ottley (Advisor: Dr.Cohen)"
date: '`r Sys.Date()`'
format:
  html:
    code-fold: true
course: Capstone Projects in Data Science
bibliography: references.bib # file contains bibtex for references
#always_allow_html: true # this allows to get PDF with HTML features
self-contained: true
execute: 
  warning: false
  message: false
editor: 
  markdown: 
    wrap: 72
---

[Literature Review](litreview.html){target="_blank"} |
[Slides](slides.html){target="_blank"}


## Introduction

  In recent years, statistical models have become indispensable tools in understanding complex data structures across various fields, including biology, social sciences, economics, and medicine. One powerful class of models that has gained significant traction is the linear mixed model (LMM). Linear mixed models extend traditional linear regression by incorporating both fixed and random effects, making them well-suited for data with hierarchical or grouped structures. Unlike standard linear models, which assume that all observations are independent, linear mixed models allow for the modeling of correlation within clusters or repeated measures, thus providing more flexibility and accuracy in analyzing real-world data.

  LMMs are particularly useful in addressing challenges such as nested data structures, longitudinal measurements, and variability across subjects or experimental units. By allowing for random effects, such models account for unobserved heterogeneity, making them invaluable in situations where individuals or units differ in ways not captured by the fixed effects alone. This flexibility enhances the model's ability to generalize and improve predictions, making it a versatile tool in both theoretical and applied research.

  Normal Linear Mixed Models (LMMs) have become a fundamental tool in statistical modeling, particularly in hierarchical data structures. LMMs account for both fixed effects, which describe population-level influences and random effects. LMMs are different from other methods such as ANOVA. This flexibility makes them particularly valuable in medical and healthcare research, where patient responses vary.

  The following is hypothetical and will be modified as further direction for the project is taken such as datasets, methodology, design and analysis. The application of LMMs spans various domains, including health-related quality of life assessments, cost predictions, blood pressure monitoring and cardiovascular studies. This paper explores the role of normal linear mixed models COVID19 testing done worldwide. This paper plans to examine advantages of LMMs over other methods such as ANOVA and linear regression. The goal of this paper is to take the Covid19 Worldwide Testing dataset and use LMMs to prove their efficiency for a particular data set such as blood pressure data. LMMs would be useful to analyze a blood pressure data set to model patient specific fluctuations. This paper will analyze a blood pressure data set using LMMs to capture circadian rhythms, REM sleep patterns and potential heart issues (hypothetical). 


## 2 Methods

Linear Mixed Models (LMMs) are a powerful statistical approach for analyzing data with both fixed and random effects, commonly used when observations are correlated or grouped (i.e., repeated measures, hierarchical data). 

The selected dataset for this project represents repeated measures data, which is data that includes observations collected from the same variable (dependent variable) multiple times, either over time or under different conditions, allowing for analysis of changes or effects within those subjects.

The goal of this analysis is to present how COVID-19 testing relates to the number of positive cases across different countries. Although we expect a general relationship, more tests leading to more positive cases, the strength of that relationship likely varies from country to country due to differences in testing strategies, population size, healthcare infrastructure, and outbreak severity.
To capture this country level variability, we apply a Linear Mixed Model framework, which allows us to analyze both overall trends and country-specific deviations. It is also important to recognize why we are using a Linear Mixed Model to answer this question. A traditional linear regression would present a single slope and intercept for all countries, which ignores the natural variation between regions. A LMM allows each country to have its own intercept or baseline number of positive cases. An LMM also allows each country to have its own slope which is presented as the effect of testing on positivity.

## 2.1 Understanding Linear Mixed Models

A Linear Mixed Model (LMM) is a flexible extension of the linear regression model that incorporates both fixed and random effects. Fixed effects represent population-level parameters that are constant across all groups (e.g., the average impact of daily testing across all countries). Random effects capture variation across clusters (e.g., countries), allowing each group to have its own intercept and/or slope. This is particularly useful for hierarchical, repeated-measures, or panel data, where observations within the same group are not independent.

LMMs are ideal for modeling data where residual errors are correlated within groups but independent across groups, which violates the assumptions of ordinary least squares (OLS) regression. They also allow analysts to partition variability into within-group and between-group components, improving both inference accuracy and generalizability.

## 2.2 Model Structure and Notation

The general form of a linear mixed model is:

$$
y_{ij} = \beta_0 + \beta_1 x_{ij} + b_{0j} + b_{1j}x_{ij} + \varepsilon_{ij}
$$
Where,

- $y_{ij}$: response variable for observation in $i$ in group $j$

- $x_{ij}$: predictor (e.g., scaled daily tests)

- $\beta_0,\beta_1$: fixed intercept and slope (population-level)

- $b_{0j}, b_{1j}$: random intercept and slope for group $j$ (e.g., country)

- $\varepsilon_{ij}$: residual error, assumed to be normally distributed: $\varepsilon_{ij} \sim N (0, \sigma^2)$

In matrix form, the LMM can be represented as:
$$
y = X\beta + Zb + \varepsilon
$$
Where,

- $y$: vector of outcomes

- $X$: fixed-effects design matrix

- $\beta$: vector of fixed effect coefficients

- $Z$: random-effects design matrix

- $b$: vector of random effects, assumed $\sim N (0, G)$

- $\varepsilon$: residual errors, assumed $\sim N(0, R)$

This framework enables the estimation of both overall trends (fixed effects) and group-specific deviations (random effects), making linear mixed models ideal for handling variability and correlation structures across clusters.


## 2.3 R Implementation

In this study, we emplyed a linear mixed model to examine the relationship between the number of daily COVID-19 positive cases reported across various countries over time. The dataset consists of repeated daily observations for each country, which resultws in multilevel structure where each country is considered a separate group with its own data points over time. This hierarchical structure gives the opportunity to account for both the overall trends in the data and the variability across different countries.

The model was designed to account for both the fixed effects of the number of daily tests conducted, which can influence case detection, and the random effects that capture country-specific deviations in testing practices and positivity rates. The model allows the both the intercept, baseline positivity, and the slope, the effect of testing on reported cases, to vary by country. This is incredibly important because different countries may have varying baseline rates of COVID-19 positivity and differing testing strategies, which may influence the number of positive cases detected.

### Key components of the model:

- Response variable: *daily_positive* — the number of newly confirmed cases per day
- Fixed effect predictor: *daily_tested_scaled* — the number of daily tests conducted (scaled by 1,000)
- Random effects: Intercept and slope for each *Country_Region*, allowing both baseline positivity and test effectiveness to vary by country

The model formula in R was specified as:

```{r}

lmer(daily_positive ~ daily_tested_scaled + (daily_tested_scaled | Country_Region), data = df_clean)

```


This structure enables the model to capture both the overall trend of case detection as influenced by the number of tests conducted, while simultaneously accounting for the heterogeneity in testing practices and baseline positivity across countries. By allowing these country-level variations, the model provides a more accurate understanding of how COVID-19 testing impacted the reported cases in different settings.


## 3 Analysis and Results


### 3.1 Data and Visualization
Data Source: **Kaggle**

[Covid19 Worldwide Testing](https://www.kaggle.com/datasets/lin0li/covid19testing/data){target="_blank"}

**Description:** This dataset, which has the number of tests conducted over time, is important to help making sense of daily reported cases and understanding how COVID-19 is truly spreading in each country.
The world generally uses daily reported positive cases to understand how COVID-19 is spreading in different countries. However, given that potentially over 50% of the cases are asymptomatic, these populations are much less likely to seek testing and get tested. Therefore, the reported cases are highly likely to be only a portion of the population who are truly infected by COVID-19, and the number of reported cases has a strong relation to the number of tests conducted each day.

For example, imagine a country not doing much testing might be reporting low number of cases, but it doesn't mean COVID-19 is not spreading in that country. To help making sense of daily reported cases and understanding how COVID-19 is truly spreading in each country, it's crucial to understand how many tests are conducted each day.

##### **Dataset Columns:**

- **Date**: an identifier for each individual
- **Country_Region**: gender of the individual (male or female)
- **Province_State**: age of the individual in years
- **Positive**: cumulative number of positive cases reported
- **Active**: number of active cases on that day
- **Hospitalized**: cumulative number of hospitalized cases reported
- **HospitalizedCurr**: number of actively hospitalized cases on that day
- **Recovered**: cumulative number of recovered cases reported
- **Death**: cumulative number of deaths reported
- **Total_tested**: cumulative number of tests conducted
- **Daily_tested**: number of tests conducted on the day; if daily data is unavailable, daily tested is averaged across of days in
- **Daily_positive**: number of positives cases reported on the day; if daily data is unavailable, daily positive is averaged across number of days in



### 3.2 Packages

```{r, warning=FALSE, echo=T, message=FALSE}
# loading packages 
library(tidyverse)
library(knitr)
library(ggthemes)
library(ggrepel)
library(dslabs)
library(lme4)
library(nlme)
library(dplyr)
library(ggplot2)

```

### 3.3 Data Import
```{r, warning=FALSE, echo=TRUE}
# Load Data
library(readr)
COVID19 <- read_csv("tested_worldwide.csv")
kable(head(COVID19))
  
```


### 3.4 Exploratory Data Analysis
```{r}

df <- COVID19
#Convert Date to Date format
df$Date <- as.Date(df$Date)

#Remove rows with missing values in relevant columns
df_clean <- df %>%
  filter(!is.na(daily_positive), !is.na(daily_tested), !is.na(Country_Region))

#Rescale daily_tested column
df_clean$daily_tested_scaled <- df_clean$daily_tested / 1000

```
In the EDA, the
### 3.5 Modeling and Results

```{r}
#Fit LMM with random intercept and slope
model_refined <- lmer(daily_positive ~ daily_tested_scaled + (daily_tested_scaled | Country_Region), data = df_clean)

head(df_clean)

#Model Summary
summary(model_refined)

```

We modeled **daily_positive** (positive cases) as a function of **daily_tested_scaled** (tests per day, divided by 1,000 for interpretability), with random slopes and intercepts for Country_Region:

**Key Results & Interpretation**

Random Effects (Country-Level Variability)
Intercept Variance: 435,521 (Std. Dev. = 659.94)
→ Countries have a wide range of baseline positivity rates.
Slope Variance (daily_tested_scaled): 4,217 (Std. Dev. = 64.94)
→ The effect of testing varies significantly across countries.
Correlation (-0.42) between intercept and slope
→ Countries with higher baseline positivity rates tend to have a lower increase in cases per additional 1,000 tests.


Fixed Effects (Overall Trend)
Intercept (95.05, p = 0.281)
→ Not significantly different from zero; suggests no strong overall baseline.
daily_tested_scaled (52.16, p < 0.001)*
→ On average, for every 1,000 tests conducted, about 52 additional positive cases are detected.


```{r}
#Get model predictions
df_clean$predicted <- predict(model_refined)

#Scatter plot with values
ggplot(df_clean, aes(x=daily_tested_scaled, y=daily_positive, color = Country_Region)) + 
   geom_point(alpha = 0.3) +  # Raw data points
  geom_line(aes(y = predicted, group = Country_Region), linewidth = 1) +  # Use linewidth instead of size
  labs(title = "LMM: Daily Positive Cases vs. Daily Tests (Per Country)",
   	x = "Daily Tests (in thousands)",
   	y = "Daily Positive Cases") +
  theme_minimal() +
  theme(legend.position = "none")  # Hides legend for clarity

```
This scatterplot shows the spread of real data across multiple different countries. The model's fitted lines per country are based on LMM predictions, which were how different countries follow unique trends. 

```{r}
# Select a subset of countries 
selected_countries <- c("United States", "India", "Brazil", "Germany", "South Korea")
df_subset <- df_clean[df_clean$Country_Region %in% selected_countries, ]
 
# Generate predictions for selected countries
df_subset$predicted <- predict(model_refined, newdata = df_subset)
 
# Plot
ggplot(df_subset, aes(x = daily_tested_scaled, y = daily_positive, color = Country_Region)) +
  geom_point(alpha = 0.6) +  # Raw data points
  geom_line(aes(y = predicted), linewidth = 1.2) +  # Use linewidth instead of size
  labs(title = "LMM Predictions for Selected Countries",
   	x = "Daily Tests (in thousands)",
   	y = "Daily Positive Cases") +
  theme_minimal()

```
This scatterplot shows the relationship between testing and positive cases for specific countries and the country-wise differences in slopes (e.g., some countries have steeper slopes than others). In addition, this scatterplot shows how the model predicts positivity rates differently per country.

### 4 Conclusion

This study applied a Linear Mixed Model (LMM) to analyze COVID-19 testing data across countries using time-indexed, repeated measures. By modeling daily positive case counts as a function of daily testing volume and allowing both intercepts and slopes to vary by country, the LMM effectively captured differences in baseline positivity and testing effectiveness across global regions.

The fixed effect results demonstrated that increased testing was significantly associated with higher detected case counts, underscoring the critical role that testing plays in understanding and managing the spread of COVID-19. Additionally, the model’s random effects revealed meaningful variation between countries—both in baseline levels of positive cases and in how each country’s positivity rate responded to increased testing.

Model diagnostics showed acceptable residual behavior, though some mild heteroscedasticity and non-normality were present, likely due to the large scale and variability of the data. A minor convergence warning suggests future refinement of optimization settings may improve model stability, but the core results remain interpretable and valid.

Overall, the use of LMMs in this context illustrates their power in handling real-world public health data that is hierarchical, unbalanced, and repeated over time. The flexibility of LMMs allows researchers to extract more meaningful insights than would be possible with simpler linear models or ANOVA, particularly when assessing country-specific patterns during a global health crisis. Future research might explore more complex temporal structures or additional covariates (e.g., vaccination rates, policy interventions) to further enhance our understanding of COVID-19 dynamics worldwide.


## 5 References
